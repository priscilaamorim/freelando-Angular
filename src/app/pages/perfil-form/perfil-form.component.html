<div class="cadastro-form">
  <div class="cadastro-form__container">
    <div class="cadastro-form__card">
      <h2 class="cadastro-form__title">Crie seu cadastro</h2>
      <p class="cadastro-form__subtitle">
        Melhore sua descri√ß√£o para atrair clientes!
      </p>

      <form [formGroup]="perfilForm" (ngSubmit)="onProximo()">
        <!-- üì∏ Upload de Foto -->
        <div class="cadastro-form__field">
          <label class="cadastro-form__label">Sua foto</label>

          <div class="cadastro-form__upload-container">
            <div
              class="cadastro-form__upload-area"
              [class.cadastro-form__upload-area--with-preview]="fotoPreview"
              (click)="fileInput.click()"
            >
              <!-- üîÅ Sem imagem: instru√ß√µes -->
              <ng-container *ngIf="!fotoPreview">
                <div>
                  <i class="fas fa-cloud-upload-alt"></i>
                  <p>
                    Arraste arquivos para esta √°rea ou clique para fazer o
                    upload
                  </p>
                </div>
              </ng-container>

              <!-- ‚úÖ Com imagem: preview -->
              <ng-container *ngIf="fotoPreview">
                <img
                  [src]="fotoPreview"
                  alt="Preview da foto"
                  class="cadastro-form__foto-preview"
                />
              </ng-container>
            </div>

            <!-- Campo oculto para upload -->
            <input
              #fileInput
              type="file"
              accept="image/*"
              style="display: none"
              (change)="onFotoSelecionada($event)"
            />
          </div>
        </div>

        <!-- üìùResumo -->
        <div class="cadastro-form__field">
          <label for="resumo" class="cadastro-form__label">Resumo</label>
          <textarea
            id="resumo"
            class="cadastro-form__textarea"
            formControlName="resumo"
            rows="3"
            maxlength="70"
          >
          </textarea>

          <div class="cadastro-form__field-info">
            <span>Fa√ßa um resumo em at√© 70 caracteres.</span>
            <span>{{ caracteresRestantes }}</span>
          </div>

          <!-- ‚ö†Ô∏è Valida√ß√£o -->
          <div class="cadastro-form__field-example">
             Exemplo: Designer experiente em identidade visual
           </div>
           <div *ngIf="perfilForm.get('resumo')?.invalid 
           && perfilForm.get('resumo')?.touched" class="cadastro-form__error">
             <span *ngIf="perfilForm.get('resumo')
             ?.errors?.['required']">Resumo √© obrigat√≥rio</span>
             <span *ngIf="perfilForm.get('resumo')
             ?.errors?.['maxlength']">Resumo deve ter no m√°ximo 70 caracteres</span>
           </div>
        </div>

        <!-- üíº Sele√ß√£o de Habilidades -->
        <div class="cadastro-form__field">
          <label class="cadastro-form__label">
            Cite at√© tr√™s habilidades que voc√™ considera principais
          </label>

          <div class="cadastro-form__chips">
            <app-chip
              *ngFor="let habilidade of habilidades"
              [text]="habilidade.nome"
              [selected]="habilidade.selecionada"
              [disabled]="
                !habilidade.selecionada &&
                perfilForm.get('habilidadesSelecionadas')?.value.length >= 3
              "
              (clicked)="toggleHabilidade(habilidade)"
            ></app-chip>
          </div>
        </div>

        <!-- üåê Idiomas -->
        <div class="cadastro-form__field">
          <div class="cadastro-form__row cadastro-form__row--header">
            <div class="cadastro-form__column">
              <label class="cadastro-form__label">Idiomas</label>
            </div>
            <div class="cadastro-form__column">
              <label class="cadastro-form__label">N√≠vel</label>
            </div>
          </div>

          <!-- üìÑ FormArray de idiomas -->
          <ng-container formArrayName="idiomas">
            <div
              class="cadastro-form__row"
              *ngFor="let idiomaForm of idiomasArray.controls; let i = index"
              [formGroupName]="i"
            >
              <!-- Idioma -->
              <div class="cadastro-form__column">
                <select
                  aria-label="Idioma"
                  class="cadastro-form__select"
                  formControlName="nome"
                >
                  <option value="" disabled>Escolha o idioma</option>
                  <option *ngFor="let idioma of idiomas" [value]="idioma">
                    {{ idioma }}
                  </option>
                </select>

                <!-- ‚ö†Ô∏è Valida√ß√£o -->
                <div
                  *ngIf="
                    idiomaForm.get('nome')?.invalid &&
                    idiomaForm.get('nome')?.touched
                  "
                  class="cadastro-form__error"
                >
                  Idioma √© obrigat√≥rio!
                </div>
              </div>

              <!-- N√≠vel -->
              <div class="cadastro-form__column cadastro-form__row">
                <select
                  class="cadastro-form__select"
                  aria-label="N√≠vel"
                  formControlName="nivel"
                >
                  <option value="" disabled>N√≠vel de conhecimento</option>
                  <option *ngFor="let nivel of niveisIdioma" [value]="nivel">
                    {{ nivel }}
                  </option>
                </select>

                <!-- ‚ö†Ô∏è Valida√ß√£o -->
                <div
                  *ngIf="
                    idiomaForm.get('nivel')?.invalid &&
                    idiomaForm.get('nivel')?.touched
                  "
                  class="cadastro-form__error"
                >
                  N√≠vel √© obrigat√≥rio
                </div>
              </div>

              <!-- ‚ùå Bot√£o de remover idioma -->
              <div class="cadastro-form__column cadastro-form__column--actions">
                <button
                  type="button"
                  class="cadastro-form__icon-button"
                  (click)="removerIdioma(i)"
                  *ngIf="i > 0 || idiomaForm.get('nome')?.value !== 'Portugu√™s'"
                  aria-label="Remover idioma"
                ></button>
              </div>
            </div>
          </ng-container>

          <!-- ‚ûï Bot√£o de adicionar idioma -->
          <div class="cadastro-form__add-button">
            <button
              type="button"
              class="cadastro-form__text-button"
              (click)="adicionarIdioma()"
              aria-label="Adicionar idioma"
            >
              <i class="fas fa-plus-circle"></i> Adicionar Idiomas
            </button>
          </div>
        </div>

        <!-- üåê Portifolio -->
        <div class="cadastro-form__field">
          <label for="portifolio" class="cadastro-form__label"
            >Portifolio</label
          >
          <input
            type="url"
            id="portifolio"
            class="cadastro-form__input"
            formControlName="portifolio"
            placeholder="Cole o link do seu portf√≥lio"/>
         
          <!-- ‚ö†Ô∏è Valida√ß√£o -->
          <div
            *ngIf="
              perfilForm.get('portifolio')?.invalid &&
              perfilForm.get('portifolio')?.touched
            "
            class="cadastro-form__error"
          >
           URL inv√°lida! Inclua http:// ou https://
          </div>
        </div>

        <!-- üìù  LinkedIn -->
        <div class="cadastro-form__field">
          <label for="linkedin" class="cadastro-form__label"
            >LinkedIn</label
          >
          <input
            type="url"
            id="linkedin"
            class="cadastro-form__input"
            formControlName="linkedin"
             placeholder="Cole o link do seu perfil no LinkedIn"/>
        
          <!-- ‚ö†Ô∏è Valida√ß√£o -->
          <div
            *ngIf="
              perfilForm.get('linkedin')?.invalid &&
              perfilForm.get('linkedin')?.touched
            "
            class="cadastro-form__error"
          >
           URL do LinkedIn inv√°lida! 
          </div>
        </div>

        <!-- ‚èÆÔ∏è‚è≠Ô∏è A√ß√µes do formul√°rio -->
        <div class="cadastro-form__actions">
          <app-button
            text="Anterior"
            type="outline"
            icon="fas fa-arrow-left"
            iconPosition="left"
            (clicked)="onAnterior()"
          ></app-button>

          <app-button
            text="Pr√≥ximo"
            type="primary"
            icon="fas fa-arrow-right"
            iconPosition="right"
            [disabled]="perfilForm.invalid"
            (clicked)="onProximo()"
          ></app-button>
        </div>
      </form>
    </div>
  </div>
</div>
